language: php
php:
  - '7.1'
  - '7.2'
cache:
  directories:
    - $HOME/.composer/cache/files
install:
  # We need a full Drupal project for our functional tests to work. Create a new project.
  - composer create-project drupal/recommended-project drupal --stability dev --no-interaction
  - composer require drupal/recurring_events --no-interaction
  # Run PHP as a webserver, in the background
  - (php -S localhost:8888 -t $(pwd)/drupal/web/ &) >> /dev/null 2>&1
script:
  - cd drupal/web && php ./core/scripts/run-tests.sh --php $(which php) --dburl sqlite://tmp/tests.sqlite --sqlite /tmp/tests.sqlite --url http://127.0.0.1:8888/ --directory modules/contrib/recurring_events/tests/ --concurrency 4